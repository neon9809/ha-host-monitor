version: '3.8'

services:
  ha-host-monitor:
    # 使用 ghcr.io 镜像（支持 amd64 和 arm64 架构）
    image: ghcr.io/neon9809/ha-host-monitor:latest
    container_name: ha-host-monitor
    restart: unless-stopped
    
    # 挂载主机系统目录用于监控
    volumes:
      # 挂载 /proc 用于系统指标（只读）
      - /proc:/host/proc:ro
      # 挂载 /sys 用于额外的系统信息（只读）
      - /sys:/host/sys:ro
      # 挂载配置目录用于配置文件和错误日志
      - ./config:/app/config
    
    # 环境变量（可选，也可以在 config.yml 中设置）
    environment:
      - PYTHONUNBUFFERED=1
      - PYTHONDONTWRITEBYTECODE=1
    
    # 资源限制（可选）
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '0.5'
    #       memory: 256M
    #     reservations:
    #       cpus: '0.25'
    #       memory: 128M
    
    # 日志配置（可选）
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
